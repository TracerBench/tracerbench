<!DOCTYPE html>
<html>

<head>
  <title>Test</title>
  <style>
    .toolTip {
      pointer-events: none;
      position: absolute;
      display: none;
      min-width: 50px;
      height: auto;
      background: none repeat scroll 0 0 #ffffff;
      padding: 9px 14px 6px 14px;
      border-radius: 2px;
      text-align: center;
      line-height: 1.3;
      color: #5B6770;
      box-shadow: 0px 3px 9px rgba(0, 0, 0, .15);
    }

    .toolTip:after {
      content: "";
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 12px solid white;
      position: absolute;
      bottom: -10px;
      left: 50%;
      margin-left: -12px;
    }

    .toolTip span {
      font-weight: 500;
      color: #081F2C;
    }
  </style>
  <script src="node_modules/d3/dist/d3.js"></script>
  <script src="dist/index.browser.js"></script>
</head>

<body>
  <svg></svg>
  <script>
    d3.json("profile.json").then((traceEvents) => {
      let trace = new Profile.Trace();
      trace.addEvents(traceEvents);
      trace.buildModel();

      let profileEvent = trace.events.find((e) => e.name === 'CpuProfile');
      trace.mainProcess = trace.process(profileEvent.pid);
      let profile = Profile.CpuProfile.from(profileEvent);

      var root = d3.hierarchy(profile.root, (node) => {
        if (node.children) {
          return node.children.map((id) => profile.nodes.get(id)).filter(node => node.callFrame.functionName !== '(idle)' && node.callFrame.functionName !== '(program)')
        }
      }).sum(d => d.hitCount).sort((a, b) => { return b.height - a.height || b.value - a.value; });

      // Variables
      var width = 1024;
      var height = 768;
      var radius = Math.min(width, height) / 2;
      var color = d3.scaleOrdinal(d3.schemeCategory10);
      var tooltip = d3.select("body").append("div").attr("class", "toolTip");

      // Create primary <g> element
      var g = d3.select('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

      // Data strucure
      var partition = d3.partition()
        .size([2 * Math.PI, radius]);

      // Size arcs
      partition(root);
      var arc = d3.arc()
        .startAngle(function (d) { return d.x0 })
        .endAngle(function (d) { return d.x1 })
        .innerRadius(function (d) { return d.y0 })
        .outerRadius(function (d) { return d.y1 });

      // Put it all together
      g.selectAll('path')
        .data(root.descendants())
        .enter().append('path')
        .attr("display", function (d) { return d.depth ? null : "none"; })
        .attr("d", arc)
        .style("fill", function (d) { return color((d.children ? d : d.parent).data.id); })
        .on("mousemove", function (d) {
          tooltip
            .style("left", d3.event.pageX - 50 + "px")
            .style("top", d3.event.pageY - 70 + "px")
            .style("display", "inline-block")
            .html(d.data.callFrame.functionName);
        })
        .on("mouseout", function (d) { tooltip.style("display", "none"); });;
    });

  </script>
</body>

</html>